# 統合設定クリエイターAPI修正タスク

## 概要
統合設定クリエイターAPIのフロントエンドとバックエンドの連携を改善し、APIレスポンス形式の標準化ポリシーに従った実装にするためのタスクリスト。

## タスク

### 1. フロントエンドのAPIクライアント関数を修正
- APIレスポンス形式の標準化ポリシーに従ったレスポンス処理を実装
- `fetchApi`関数がDRFの標準ページネーション形式を正しく処理できるように修正

### 2. 現在のテストスクリプトのバックアップを作成
- `test_integrated_setting_creator.ts`のバックアップを`test_integrated_setting_creator.backup.ts`として保存
- 元のテストスクリプトの動作を保存しておく

### 3. テストスクリプトをフロントエンドと同じAPIクライアント関数を使用するように修正
- テストスクリプトが`api-client.ts`の`fetchApi`関数を使用するように変更
- 同じエンドポイントとデータ構造を維持

### 4. テストスクリプトの保存関数を移植可能なポータブルな形で書き直し
- `saveIntegratedSettingCreatorData`関数を再利用可能な形に書き直し
- フロントエンドに移植しやすい構造にする

### 5. テストスクリプトが動作するまでテスト
- 修正したテストスクリプトを実行して動作確認
- 問題がある場合はバックアップを参考に修正
- 完全に動作するまで繰り返し調整

### 6. 保存関数をフロントエンドに移植
- テストで検証済みの保存関数をフロントエンドに移植
- `page.tsx`の`saveSettings`関数を修正
- APIレスポンス処理を標準化ポリシーに合わせる

### 7. フロントエンドのテスト
- 修正したフロントエンドを実際に動作させてテスト
- 統合設定データの保存と取得が正常に行われることを確認
- エラーハンドリングが適切に機能することを確認

## 注意事項
- 各ステップで変更を最小限に抑え、一度に大量の変更を行わない
- 各ステップでテストを行い、問題があればすぐに修正
- APIレスポンス形式の標準化ポリシーに従った実装を徹底する

# APIレスポンスステータスコード標準化タスク

## 概要
バックエンドAPIのステータスコード返却を標準化し、データが存在しない場合は404ではなく204 No Contentを返すように修正します。また、フロントエンドも204レスポンスを適切に処理するように修正します。

## タスク

### 1. バックエンドAPIエンドポイントの修正

#### 1.1 基本設定関連のビュー修正
- [x] `BasicSettingDetailView`の`retrieve`メソッドを修正し、データが存在しない場合に204を返すように変更
- [ ] `BasicSettingDataDetailView`の`retrieve`メソッドを修正し、データが存在しない場合に204を返すように変更
- [ ] `BasicSettingCreateView`のエラーハンドリングを確認し、必要に応じて修正

#### 1.2 統合設定クリエイター関連のビュー修正
- [x] `IntegratedSettingCreatorDetailView`のデータ取得処理を修正し、データが存在しない場合に204を返すように変更
- [ ] `IntegratedSettingCreatorView`のエラーハンドリングを確認し、必要に応じて修正

#### 1.3 キャラクター詳細関連のビュー修正
- [ ] `CharacterDetailView`の`retrieve`メソッドを修正し、データが存在しない場合に204を返すように変更
- [ ] `CharacterDetailListCreateView`のエラーハンドリングを確認し、必要に応じて修正

#### 1.4 あらすじ詳細関連のビュー修正
- [ ] `ActDetailView`の`retrieve`メソッドを修正し、データが存在しない場合に204を返すように変更
- [ ] `ActDetailListView`のエラーハンドリングを確認し、必要に応じて修正

#### 1.5 エピソード詳細関連のビュー修正
- [ ] `EpisodeDetailView`の`retrieve`メソッドを修正し、データが存在しない場合に204を返すように変更
- [ ] `EpisodeDetailListView`のエラーハンドリングを確認し、必要に応じて修正
- [ ] `StoryEpisodesListView`のエラーハンドリングを確認し、必要に応じて修正

#### 1.6 エピソード本文関連のビュー修正
- [ ] `EpisodeContentView`の`retrieve`メソッドを修正し、データが存在しない場合に204を返すように変更
- [ ] `CreateEpisodeContentView`のエラーハンドリングを確認し、必要に応じて修正

### 2. フロントエンドのAPI関数修正

#### 2.1 APIクライアント関数の修正
- [x] `getIntegratedSettingData`関数を修正し、204レスポンスを適切に処理するように変更
- [ ] `getBasicSettingData`関数を修正し、204レスポンスを適切に処理するように変更
- [ ] `getCharacterDetails`関数を修正し、204レスポンスを適切に処理するように変更
- [ ] `getActDetails`関数を修正し、204レスポンスを適切に処理するように変更
- [ ] `getEpisodeDetails`関数を修正し、204レスポンスを適切に処理するように変更
- [ ] `getEpisodeContent`関数を修正し、204レスポンスを適切に処理するように変更

#### 2.2 Next.js APIルートの修正
- [ ] `/api/stories/[id]/basic-setting/route.ts`を修正し、バックエンドから204が返された場合の処理を追加
- [ ] `/api/stories/[id]/integrated-setting-creator/route.ts`を修正し、バックエンドから204が返された場合の処理を追加
- [ ] `/api/stories/[id]/characters/route.ts`を修正し、バックエンドから204が返された場合の処理を追加
- [ ] `/api/stories/[id]/acts/route.ts`を修正し、バックエンドから204が返された場合の処理を追加
- [ ] `/api/stories/[id]/episodes/route.ts`を修正し、バックエンドから204が返された場合の処理を追加
- [ ] `/api/episodes/[id]/content/route.ts`を修正し、バックエンドから204が返された場合の処理を追加

### 3. テストプログラムの修正

#### 3.1 統合設定クリエイターテストの修正
- [ ] `test_integrated_setting_creator.ts`を修正し、204レスポンスを適切に処理するように変更
- [ ] 修正したテストプログラムを実行し、正常に動作することを確認

#### 3.2 基本設定テストの修正
- [ ] `test_basic_setting.ts`を修正し、204レスポンスを適切に処理するように変更
- [ ] 修正したテストプログラムを実行し、正常に動作することを確認

#### 3.3 その他のテストプログラムの修正
- [ ] キャラクター詳細、あらすじ詳細、エピソード詳細、エピソード本文に関するテストプログラムを確認し、必要に応じて修正

### 4. ドキュメントの更新

#### 4.1 API仕様書の更新
- [x] `api_endpoint_mapping.md`にAPIレスポンスのステータスコード標準を追加
- [ ] `api_test_guidelines.md`を更新し、204レスポンスのテスト方法を追加

#### 4.2 開発者向けドキュメントの更新
- [ ] `development_guidelines.md`を更新し、APIレスポンスのステータスコード標準を説明

## 実行計画

1. バックエンドAPIエンドポイントを一つずつ修正し、curlコマンドでテスト
2. フロントエンドのAPI関数を一つずつ修正し、ブラウザコンソールでテスト
3. テストプログラムを修正し、実行して動作確認
4. ドキュメントを更新し、変更内容を反映

## 注意事項
- 各ステップで変更を最小限に抑え、一度に大量の変更を行わない
- 各ステップでテストを行い、問題があればすぐに修正
- APIレスポンス形式の標準化ポリシーに従った実装を徹底する
