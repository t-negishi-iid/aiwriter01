# タスク管理システム

## 完了したタスク

- [x] 通知関連のAPIテスト実装
- [x] 検索機能のAPIテスト実装
- [x] 現状のコードをGitHubにコミット（2025/3/4）
- [x] Dify APIとの連携機能実装
- [x] APIテストの実装（基本設定、キャラクター詳細、あらすじ詳細など）
- [x] フロントエンドの型定義の更新（BasicSetting型の属性追加）
- [x] フロントエンドの型定義の更新（CharacterDetail型とCharacterDetailCreate型の追加）
- [x] フロントエンドのAPI関数の追加（キャラクター詳細関連のAPI関数）
- [x] フロントエンド環境変数の設定（NEXT_PUBLIC_API_URL）

## 現在のタスク

### API不整合解消プロジェクト

- [x] 第1フェーズ: フロントエンドとバックエンドのAPI仕様書作成
  - [x] バックエンドのすべてのAPIエンドポイントの洗い出しと整理
  - [x] フロントエンドのAPI呼び出し関数の現状分析
  - [x] API仕様書のテンプレート作成
  - [x] 各エンドポイントの入出力形式と期待値のドキュメント化

- [x] Django / Next.js 一気通貫テストシステムの実装
  - [x] スルーAPI（プロキシAPI）の実装
  - [x] TypeScriptテストスクリプトの作成
  - [x] バックエンドテストによる仕様確定
  - [x] フロントエンド側のテスト
  - [x] CypressによるヘッドレスUIテスト実装
  - [x] テスト方法論のドキュメント化
  - [x] 各エンドポイントの入出力形式と期待値のドキュメント化

- [x] 第2フェーズ: エピソード関連のエンドポイント不整合修正
  - [x] エピソード取得エンドポイントの修正 (`/acts/<int:act_id>/episodes/<int:pk>/`)
  - [x] フロントエンドの `getEpisode` 関数の修正（`storyId` を `actId` に変更）
  - [x] エピソードコンテンツ取得関数の修正（不要な `storyId` パラメータ削除）
  - [x] 修正済みエンドポイントのテスト実施

- [x] 第3フェーズ: プロット詳細取得の不整合修正
  - [x] プロット取得のバックエンドエンドポイント確認
  - [x] フロントエンドの `getPlot` および `getPlotDetail` 関数の修正
  - [x] プロット関連データモデルとインターフェースの整合性確認
  - [x] 修正済みプロット関連APIのテスト実施

- [x] 第4フェーズ: API呼び出し手法の統一
  - [x] 直接 `fetch` を使用している関数の特定
  - [x] すべてのAPI呼び出しを `fetchApi` ヘルパー関数に統一
  - [x] エラーハンドリングの一貫性確保
  - [x] 修正後のAPI呼び出しテスト

- [ ] 第5フェーズ: フロントエンドの型定義整備
  - [ ] バックエンドのシリアライザーとフロントエンドの型定義の比較
  - [ ] 命名規則の統一（キャメルケース⇔スネークケース変換）
  - [ ] 不足している型定義の追加
  - [ ] 型定義の検証とテスト
- [x] 第6フェーズ: 統合テストと最終確認
  - [x] すべての修正済みエンドポイントの統合テスト
  - [x] ユーザーフロー全体でのAPI連携テスト
  - [x] エラーケースのテスト
  - [x] パフォーマンス確認
  - [x] Next.jsとDjangoのAPI連携設定修正
  - [ ] パフォーマンス確認

- [ ] 第7フェーズ: APIルーティング構造の統一
  - [ ] フロントエンドAPIパス構造の見直し
  - [ ] クエリパラメータ形式への移行（/api/story-endpoint?id=xxx）
  - [ ] ネストされた動的ルーティングの安定性強化
  - [ ] バックエンド転送ロジックの標準化
  - [ ] 既存APIエンドポイントの新構造への順次移行
  - [ ] テスト全体の更新（新しいURL構造に合わせる）
  - [ ] 統一されたAPIパス規則のドキュメント整備

### バックエンドモデルの整理と統合

- [ ] novel_appとnovel_genのモデル重複を解消
- [ ] マイグレーション作成と適用
- [ ] モデル関連のビジネスロジックの整理

### バックエンドAPIの完成

- [ ] 基本設定作成用データAPIの完成（選択肢取得、保存、プレビュー）
- [ ] 基本設定生成APIの実装改善とエラーハンドリング強化
- [ ] キャラクター詳細APIの実装（キャラクター抽出、生成、保存）
- [ ] あらすじ詳細APIの実装（生成、保存、取得）
- [ ] エピソード詳細APIの実装（生成、取得、更新）
- [ ] エピソード本文APIの実装（生成、編集、保存）
- [ ] タイトル生成API（エピソード、幕、小説タイトル）
- [ ] クレジット管理API（残高確認、消費、追加）

### フロントエンド実装（優先順）

- [ ] 共通レイアウトとナビゲーション実装
- [ ] 小説一覧・作成画面
- [x] 基本設定作成用データ入力フォーム
- [x] 基本設定生成・表示画面
- [x] キャラクター詳細生成・表示画面
- [ ] あらすじ詳細生成・表示画面
- [ ] エピソード詳細生成・表示画面
- [ ] エピソード本文生成・編集画面
- [ ] クレジット管理画面
- [ ] ローディング状態とエラー表示の共通処理

## 次のタスク

- [ ] Docker環境の整備と確認
  - [x] バックエンドのentrypoint.shの簡素化（ncコマンド関連のエラー修正）
  - [x] フロントエンド・バックエンド間の疎通確認機能の実装
    - [x] バックエンド側：認証不要の `/api/is_live` エンドポイント作成
    - [x] フロントエンド側：接続テスト用の `/tools/connection-test` ページ追加
    - [x] フロントエンド側：`/api/is_live` エンドポイント作成（バックエンドの疎通確認用）
  - [x] 小説作成機能の改善
    - [x] フロントエンド側：`/api/stories/new` エンドポイント作成（バックエンドの小説作成APIへのプロキシ）
    - [x] 小説作成テストスクリプト `test_stories_new.ts` 作成
    - [x] フロントエンド用の `useStoryCreation` フックとページ実装
    - [x] テストスクリプトの強化：フロントエンド/バックエンド直接アクセス比較機能追加
    - [x] テスト機能のドキュメント整備：`api_test_guidelines.md` と `tests/README.md` 作成
    - [x] Cypress E2Eテスト実装：新規小説作成ページのUIとAPI連携テスト
  - [ ] 開発環境の起動スクリプト作成
  - [ ] ボリュームマウント設定の確認

- [ ] デモデータの作成
  - [ ] テスト用小説データの作成
  - [ ] 初回ログイン時のチュートリアル表示

- [ ] パフォーマンス最適化とエラーハンドリング
  - [ ] API応答の高速化
  - [ ] フロントエンドのパフォーマンス改善
  - [ ] エラー表示とリカバリー処理の強化

## 注意事項

- タスクを完了したら、このリストを更新する
- 新しいタスクが発生したら、適切なセクションに追加する
- 重複作業を避けるため、常にこのリストを参照する
- 基本設定→キャラクター→あらすじ→エピソードの順序で実装を進める
- API不整合解消は最優先で取り組み、安定した通信を確保する
